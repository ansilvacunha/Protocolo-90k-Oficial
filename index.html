<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocolo 90K - V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        'prot-bg': '#0f0f10',
                        'prot-card': '#18181b',
                        'prot-border': '#27272a',
                        'prot-orange': '#f97316',
                        'prot-orange-dim': '#c2410c',
                        'prot-green': '#22c55e',
                        'prot-red': '#ef4444',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0f0f10; color: #e4e4e7; -webkit-tap-highlight-color: transparent; }
        .card { background-color: #18181b; border: 1px solid #27272a; border-radius: 16px; box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.5); }
        input, button { outline: none; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes pulse-border { 0% { border-color: #27272a; } 50% { border-color: #f97316; } 100% { border-color: #27272a; } }
        .focus-pulse:focus-within { animation: pulse-border 2s infinite; }

        /* Graph Utilities */
        .chart-line { fill: none; stroke: #f97316; stroke-width: 3; vector-effect: non-scaling-stroke; stroke-linecap: round; }
        .chart-dot { fill: #18181b; stroke: #f97316; stroke-width: 2; r: 4; }
        .chart-area { fill: rgba(249, 115, 22, 0.1); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "recharts": "https://aistudiocdn.com/recharts@^3.5.1",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0"
  }
}
</script>
</head>
<body class="pb-20 select-none">

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 bg-prot-green text-black font-bold px-6 py-3 rounded-full shadow-xl shadow-green-900/20 translate-y-[-150%] transition-transform duration-300 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        <span id="toast-msg">Sucesso!</span>
    </div>

    <!-- HEADER -->
    <header class="sticky top-0 z-40 bg-prot-bg/80 backdrop-blur-md border-b border-prot-border">
        <div class="max-w-md mx-auto px-5 py-4 flex justify-between items-center">
            <div>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest font-bold mb-0.5">Protocolo 90K</p>
                <h1 class="text-xl font-black italic text-white tracking-tight">
                    REI <span class="text-prot-orange">ANDERSON</span>
                </h1>
            </div>
            <div class="text-right">
                <div class="flex items-center justify-end gap-2 mb-1">
                    <span id="header-weight" class="text-xl font-bold text-white">--</span>
                    <span class="text-xs text-gray-500">kg atual</span>
                </div>
                <div class="flex gap-2 text-[10px] font-mono text-gray-400">
                    <span class="bg-white/5 px-1.5 py-0.5 rounded">META: 90kg</span>
                    <span class="bg-white/5 px-1.5 py-0.5 rounded">TETO: 1750kcal</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 pt-6 space-y-6">

        <!-- 1. NUTRI√á√ÉO & BUSCA -->
        <section class="card p-5 animate-fade-in relative overflow-visible z-30">
            <div class="flex justify-between items-end mb-3">
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider flex items-center gap-2">
                    <svg class="w-4 h-4 text-prot-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    Controle Cal√≥rico
                </h3>
                <div class="text-right">
                    <span id="nutri-val" class="text-2xl font-bold text-white">0</span>
                    <span class="text-xs text-gray-500">/ 1750</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="h-2 w-full bg-gray-800 rounded-full overflow-hidden mb-6">
                <div id="nutri-bar" class="h-full bg-prot-orange transition-all duration-500 shadow-[0_0_10px_rgba(249,115,22,0.5)]" style="width: 0%"></div>
            </div>

            <!-- SEARCH INPUT -->
            <div class="relative group focus-pulse rounded-xl bg-black/40 border border-prot-border transition-colors hover:border-gray-600 mb-4">
                <div class="flex items-center px-4 py-3">
                    <svg class="w-5 h-5 text-gray-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    <input id="food-search" type="text" placeholder="Buscar alimento (ex: Arroz...)" 
                           class="w-full bg-transparent text-sm text-white placeholder-gray-600 focus:outline-none"
                           autocomplete="off">
                </div>
                
                <!-- DROPDOWN RESULTS -->
                <div id="search-results" class="hidden absolute top-full left-0 right-0 mt-2 bg-[#1c1c1f] border border-prot-border rounded-xl shadow-2xl overflow-hidden max-h-60 overflow-y-auto z-50">
                    <!-- Results injected here -->
                </div>
            </div>

            <!-- History Summary -->
            <div id="meal-history" class="space-y-2 mt-4 max-h-40 overflow-y-auto pr-1">
                <!-- History Items injected here -->
                <div class="text-center text-xs text-gray-600 py-2 italic">Nenhum registro hoje.</div>
            </div>
        </section>

        <!-- 2. FITNESS MODULE -->
        <section class="card p-5 animate-fade-in" style="animation-delay: 0.1s">
            <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider flex items-center gap-2 mb-4">
                <svg class="w-4 h-4 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Atividade F√≠sica (B√¥nus)
            </h3>

            <div class="grid grid-cols-1 gap-3">
                <button onclick="addExercise('bike')" id="btn-bike" class="flex items-center justify-between p-4 bg-gray-800/50 hover:bg-gray-800 border border-transparent hover:border-prot-orange/50 rounded-xl transition-all group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üö¥‚Äç‚ôÇÔ∏è</span>
                        <div class="text-left">
                            <div class="font-bold text-gray-200">Bicicleta</div>
                            <div class="text-[10px] text-gray-500">Cardio Moderado ‚Ä¢ 30 min</div>
                        </div>
                    </div>
                    <div class="w-6 h-6 rounded-full border-2 border-gray-600 group-hover:border-prot-orange flex items-center justify-center exercise-check" data-type="bike"></div>
                </button>

                <button onclick="addExercise('rope')" id="btn-rope" class="flex items-center justify-between p-4 bg-gray-800/50 hover:bg-gray-800 border border-transparent hover:border-prot-orange/50 rounded-xl transition-all group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üî•</span>
                        <div class="text-left">
                            <div class="font-bold text-gray-200">Pular Corda</div>
                            <div class="text-[10px] text-gray-500">HIIT Intenso ‚Ä¢ 10 min</div>
                        </div>
                    </div>
                    <div class="w-6 h-6 rounded-full border-2 border-gray-600 group-hover:border-prot-orange flex items-center justify-center exercise-check" data-type="rope"></div>
                </button>

                <button onclick="addExercise('gym')" id="btn-gym" class="flex items-center justify-between p-4 bg-gray-800/50 hover:bg-gray-800 border border-transparent hover:border-prot-orange/50 rounded-xl transition-all group">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üí™</span>
                        <div class="text-left">
                            <div class="font-bold text-gray-200">Muscula√ß√£o</div>
                            <div class="text-[10px] text-gray-500">For√ßa / Hipertrofia</div>
                        </div>
                    </div>
                    <div class="w-6 h-6 rounded-full border-2 border-gray-600 group-hover:border-prot-orange flex items-center justify-center exercise-check" data-type="gym"></div>
                </button>
            </div>
        </section>

        <!-- 3. HIDRATA√á√ÉO -->
        <section class="card p-5 animate-fade-in" style="animation-delay: 0.15s">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider flex items-center gap-2">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                    Meta de √Ågua (4L)
                </h3>
                <span id="water-val" class="text-blue-400 font-bold font-mono">0%</span>
            </div>

            <div class="h-3 w-full bg-gray-800 rounded-full overflow-hidden mb-5">
                <div id="water-bar" class="h-full bg-blue-600 transition-all duration-500 relative" style="width: 0%">
                    <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <button onclick="addWater(250)" class="bg-gray-800 hover:bg-gray-700 text-gray-300 py-3 rounded-lg text-xs font-bold transition-colors">+250ml</button>
                <button onclick="addWater(500)" class="bg-blue-900/30 hover:bg-blue-900/50 text-blue-200 border border-blue-900/50 py-3 rounded-lg text-xs font-bold transition-colors">+500ml</button>
                <button onclick="addWater(1000)" class="bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-lg text-xs font-bold transition-colors shadow-lg shadow-blue-900/40">+1L</button>
            </div>
        </section>

        <!-- 4. MANIPULADOS (4 PHASES) -->
        <section class="card p-5 animate-fade-in" style="animation-delay: 0.2s">
            <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-4 flex items-center gap-2">
                <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                Manipulados
            </h3>
            <div id="meds-container" class="space-y-4">
                <!-- Med Groups Injected Here -->
            </div>
        </section>

        <!-- 5. PESO -->
        <section class="card p-5 animate-fade-in" style="animation-delay: 0.25s">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 text-xs font-bold uppercase tracking-wider">Hist√≥rico de Peso</h3>
                <button onclick="toggleWeightInput()" class="text-prot-orange text-xs font-bold hover:underline">+ Novo Registro</button>
            </div>
            
            <form id="weight-form" onsubmit="addWeight(event)" class="hidden mb-4 flex gap-2 animate-fade-in">
                <input id="weight-input" type="number" step="0.1" placeholder="Kg" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 text-white focus:border-prot-orange">
                <button class="bg-prot-orange text-white px-4 py-2 rounded-lg font-bold">OK</button>
            </form>

            <div id="chart-container" class="w-full h-32 bg-black/20 rounded-lg border border-gray-800 relative">
                <!-- SVG Chart -->
            </div>
        </section>

        <!-- FOOTER RESET -->
        <div class="text-center pt-8 pb-4">
            <button onclick="forceReset()" class="text-[10px] text-gray-700 hover:text-prot-red transition-colors font-mono">
                [ DEBUG: FORCE DAILY RESET ]
            </button>
        </div>

    </main>

    <script>
        // --- 1. CONFIG & DB ---
        const CONFIG = {
            calsGoal: 1750,
            waterGoal: 4000, // ml
            startWeight: 106,
            goalWeight: 90
        };

        const FOOD_DB = [
            { name: 'Arroz Branco (100g)', cals: 128 },
            { name: 'Arroz Integral (100g)', cals: 110 },
            { name: 'Feij√£o Carioca (1 Concha)', cals: 77 },
            { name: 'Frango Grelhado (100g)', cals: 159 },
            { name: 'Carne Mo√≠da Patinho (100g)', cals: 219 },
            { name: 'Ovo Cozido/Mexido (Unid)', cals: 70 },
            { name: 'Whey Protein (Dose 30g)', cals: 120 },
            { name: 'Banana Prata (M√©d)', cals: 90 },
            { name: 'Ma√ß√£ (Unid)', cals: 60 },
            { name: 'P√£o Integral (Fatia)', cals: 60 },
            { name: 'Tapioca (100g)', cals: 130 },
            { name: 'Azeite de Oliva (1 Colher Sopa)', cals: 108 },
            { name: 'Caf√© sem a√ß√∫car (X√≠cara)', cals: 2 },
            { name: 'Batata Doce Cozida (100g)', cals: 86 },
            { name: 'Iogurte Natural (Pote)', cals: 100 },
            { name: 'Aveia em Flocos (30g)', cals: 104 }
        ];

        const MEDS_CONFIG = {
            morning: { label: 'Manh√£', items: ['Cafe√≠na', 'Citrus', 'Ioimbina'] },
            lunch: { label: 'Almo√ßo', items: ['Glucomannan', 'Psyllium (Fibras)'] },
            dinner: { label: 'Jantar', items: ['Glucomannan', 'Psyllium (Fibras)'] },
            night: { label: 'Noite', items: ['Morosil', 'Relora'] }
        };

        // --- 2. STATE ---
        let state = {
            water: 0,
            nutritionHistory: [], // {id, name, cals, date}
            weightHistory: [], // {date, weight}
            exerciseHistory: [], // {id, type, date}
            medications: [], // {id, group, name, taken, date}
            lastActiveDate: ''
        };

        // --- 3. INIT & PERSISTENCE ---
        function init() {
            const saved = localStorage.getItem('proto90k_v3');
            if(saved) {
                state = JSON.parse(saved);
            } else {
                // First boot
                state.lastActiveDate = new Date().toDateString();
                state.weightHistory.push({ date: new Date().toISOString(), weight: CONFIG.startWeight });
                seedMeds();
            }

            checkDailyReset();
            renderAll();
        }

        function seedMeds() {
            // Re-generate med structure based on current date
            const today = new Date().toDateString();
            state.medications = [];
            Object.keys(MEDS_CONFIG).forEach(group => {
                MEDS_CONFIG[group].items.forEach(item => {
                    state.medications.push({
                        id: group + '-' + item.replace(/\s/g, ''),
                        group: group,
                        name: item,
                        taken: false,
                        date: today
                    });
                });
            });
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            if(state.lastActiveDate !== today) {
                state.water = 0;
                seedMeds(); // Reset meds for today
                state.lastActiveDate = today;
                save();
            }
        }

        function save() {
            localStorage.setItem('proto90k_v3', JSON.stringify(state));
            renderAll();
        }

        // --- 4. CORE ACTIONS ---

        // Nutrition
        function addFood(name, cals) {
            state.nutritionHistory.push({
                id: Date.now(),
                name,
                cals,
                date: new Date().toISOString()
            });
            save();
            showToast(`+${cals} kcal adicionado`);
            document.getElementById('food-search').value = '';
            document.getElementById('search-results').classList.add('hidden');
        }

        function removeFood(id) {
            state.nutritionHistory = state.nutritionHistory.filter(i => i.id !== id);
            save();
        }

        // Water
        function addWater(ml) {
            state.water += ml;
            save();
            if(state.water >= CONFIG.waterGoal && (state.water - ml) < CONFIG.waterGoal) {
                showToast("üèÜ Meta de √Ågua Batida!");
            }
        }

        // Exercise
        function addExercise(type) {
            state.exerciseHistory.push({
                id: Date.now(),
                type: type,
                date: new Date().toISOString()
            });
            save();
            showToast("Atividade Registrada!");
        }

        // Meds
        function toggleMed(id) {
            const med = state.medications.find(m => m.id === id);
            if(med) {
                med.taken = !med.taken;
                save();
            }
        }

        // Weight
        function addWeight(e) {
            e.preventDefault();
            const input = document.getElementById('weight-input');
            const val = parseFloat(input.value);
            if(val) {
                state.weightHistory.push({ date: new Date().toISOString(), weight: val });
                input.value = '';
                document.getElementById('weight-form').classList.add('hidden');
                save();
                showToast("Peso Atualizado");
            }
        }

        function toggleWeightInput() {
            document.getElementById('weight-form').classList.toggle('hidden');
        }

        // --- 5. RENDER LOGIC ---

        function renderAll() {
            renderHeader();
            renderNutrition();
            renderWater();
            renderMeds();
            renderFitness();
            renderWeightGraph();
        }

        function renderHeader() {
            const lastWeight = state.weightHistory[state.weightHistory.length-1].weight;
            document.getElementById('header-weight').innerText = lastWeight;
        }

        function renderNutrition() {
            const today = new Date().toDateString();
            const todayLogs = state.nutritionHistory.filter(n => new Date(n.date).toDateString() === today);
            const total = todayLogs.reduce((acc, cur) => acc + cur.cals, 0);

            // Update Counter & Bar
            document.getElementById('nutri-val').innerText = total;
            document.getElementById('nutri-val').className = total > CONFIG.calsGoal ? 'text-2xl font-bold text-prot-red' : 'text-2xl font-bold text-white';
            
            const pct = Math.min((total / CONFIG.calsGoal) * 100, 100);
            const bar = document.getElementById('nutri-bar');
            bar.style.width = pct + '%';
            bar.className = total > CONFIG.calsGoal 
                ? 'h-full bg-prot-red shadow-[0_0_10px_rgba(239,68,68,0.5)] transition-all' 
                : 'h-full bg-prot-orange shadow-[0_0_10px_rgba(249,115,22,0.5)] transition-all';

            // List
            const container = document.getElementById('meal-history');
            if(todayLogs.length === 0) {
                container.innerHTML = '<div class="text-center text-xs text-gray-600 py-2 italic">Nenhum registro hoje.</div>';
            } else {
                container.innerHTML = todayLogs.slice().reverse().map(item => `
                    <div class="flex justify-between items-center text-xs bg-gray-800/30 p-2 rounded border border-gray-800">
                        <span class="text-gray-300 font-medium">${item.name}</span>
                        <div class="flex items-center gap-3">
                            <span class="text-prot-orange font-bold">${item.cals} kcal</span>
                            <button onclick="removeFood(${item.id})" class="text-gray-600 hover:text-red-500">‚úï</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderWater() {
            const pct = Math.min((state.water / CONFIG.waterGoal) * 100, 100);
            document.getElementById('water-bar').style.width = pct + '%';
            document.getElementById('water-val').innerText = pct.toFixed(0) + '%';
            if(pct >= 100) document.getElementById('water-val').classList.replace('text-blue-400', 'text-prot-green');
        }

        function renderFitness() {
            const today = new Date().toDateString();
            // Reset visuals
            document.querySelectorAll('.exercise-check').forEach(el => {
                el.innerHTML = '';
                el.className = 'w-6 h-6 rounded-full border-2 border-gray-600 group-hover:border-prot-orange flex items-center justify-center exercise-check';
                el.parentElement.classList.remove('border-prot-green/50', 'bg-green-900/20');
            });

            // Check done exercises today
            const doneToday = state.exerciseHistory.filter(e => new Date(e.date).toDateString() === today);
            
            doneToday.forEach(ex => {
                const checkEl = document.querySelector(`.exercise-check[data-type="${ex.type}"]`);
                if(checkEl) {
                    checkEl.innerHTML = '<svg class="w-4 h-4 text-prot-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>';
                    checkEl.className = 'w-6 h-6 rounded-full border-2 border-prot-green flex items-center justify-center exercise-check';
                    checkEl.parentElement.classList.add('border-prot-green/50', 'bg-green-900/10');
                }
            });
        }

        function renderMeds() {
            const container = document.getElementById('meds-container');
            container.innerHTML = '';
            
            ['morning', 'lunch', 'dinner', 'night'].forEach(group => {
                const meds = state.medications.filter(m => m.group === group);
                const isAllDone = meds.every(m => m.taken);
                
                const html = `
                    <div class="border border-gray-800 rounded-xl overflow-hidden">
                        <div class="bg-gray-800/50 px-4 py-2 flex justify-between items-center">
                            <span class="text-xs font-bold uppercase text-gray-400">${MEDS_CONFIG[group].label}</span>
                            ${isAllDone ? '<span class="text-xs text-prot-green font-bold">‚úì FEITO</span>' : ''}
                        </div>
                        <div class="p-2 space-y-1">
                            ${meds.map(med => `
                                <button onclick="toggleMed('${med.id}')" class="w-full flex items-center justify-between p-2 rounded hover:bg-white/5 transition-colors ${med.taken ? 'opacity-50' : ''}">
                                    <span class="text-sm text-gray-200 ${med.taken ? 'line-through' : ''}">${med.name}</span>
                                    <div class="w-5 h-5 rounded border ${med.taken ? 'bg-prot-green border-prot-green' : 'border-gray-600'} flex items-center justify-center">
                                        ${med.taken ? '<svg class="w-3 h-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>' : ''}
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderWeightGraph() {
            const container = document.getElementById('chart-container');
            const data = state.weightHistory;
            if(data.length < 2) {
                container.innerHTML = '<div class="h-full flex items-center justify-center text-xs text-gray-500">Registre mais pesos para ver o gr√°fico</div>';
                return;
            }

            // Normalization
            const weights = data.map(d => d.weight);
            const max = Math.max(...weights) + 1;
            const min = Math.min(...weights, CONFIG.goalWeight) - 1;
            const range = max - min;
            const w = container.clientWidth;
            const h = container.clientHeight;

            // Points
            const points = data.map((d, i) => {
                const x = (i / (data.length - 1)) * w;
                const y = h - ((d.weight - min) / range) * h;
                return `${x},${y}`;
            }).join(' ');

            const goalY = h - ((CONFIG.goalWeight - min) / range) * h;

            container.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
                    <line x1="0" y1="${goalY}" x2="${w}" y2="${goalY}" stroke="#22c55e" stroke-width="1" stroke-dasharray="5,5" opacity="0.5" />
                    <text x="${w-5}" y="${goalY-5}" fill="#22c55e" font-size="10" text-anchor="end">Meta 90kg</text>
                    <polyline points="${points}" class="chart-line" />
                    ${data.map((d, i) => {
                         const x = (i / (data.length - 1)) * w;
                         const y = h - ((d.weight - min) / range) * h;
                         return `<circle cx="${x}" cy="${y}" class="chart-dot" />`;
                    }).join('')}
                </svg>
            `;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-y-[-150%]');
            setTimeout(() => {
                t.classList.add('translate-y-[-150%]');
            }, 2500);
        }

        function forceReset() {
            if(confirm('Isso vai zerar o progresso do dia. Confirma?')) {
                state.lastActiveDate = ''; // Will trigger reset on reload logic
                init();
            }
        }

        // --- 6. SEARCH LOGIC ---
        const searchInput = document.getElementById('food-search');
        const resultsBox = document.getElementById('search-results');

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if(term.length < 2) {
                resultsBox.classList.add('hidden');
                return;
            }

            const matches = FOOD_DB.filter(f => f.name.toLowerCase().includes(term));
            
            if(matches.length > 0) {
                resultsBox.innerHTML = matches.map(f => `
                    <button onclick="addFood('${f.name}', ${f.cals})" class="w-full text-left px-4 py-3 hover:bg-gray-800 border-b border-gray-800 last:border-0 flex justify-between items-center group">
                        <span class="text-gray-300 group-hover:text-white transition-colors">${f.name}</span>
                        <span class="text-prot-orange font-bold text-xs">${f.cals} kcal</span>
                    </button>
                `).join('');
                resultsBox.classList.remove('hidden');
            } else {
                resultsBox.innerHTML = '<div class="px-4 py-3 text-gray-500 text-xs italic">Nada encontrado. <br>Use "Arroz", "Frango", etc.</div>';
                resultsBox.classList.remove('hidden');
            }
        });

        // Close search on click outside
        document.addEventListener('click', (e) => {
            if(!e.target.closest('#food-search') && !e.target.closest('#search-results')) {
                resultsBox.classList.add('hidden');
            }
        });

        // START
        init();
    </script>
</body>
</html>
